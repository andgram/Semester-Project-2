import{l as u}from"./main-DxMEcUNX.js";import{b as g}from"./readAuction-DM6NZyQF.js";import{b as f,h as p,d as m}from"./headers-es2B9U5o.js";import{a as h}from"./authGuard-C2GFzsuy.js";function y(e,t){const n=t.data;if(n.length===0){e.innerHTML='<div id="message">No listings yet</div>';return}e.innerHTML="";const a=n.map(r=>b(r));typeof a[0]=="string"?e.innerHTML=a.join(""):e.append(...a)}function b(e){const{id:t,title:n,media:a}=e,r=document.createElement("a");r.classList.add("auction-item"),r.href=`/auction/details/?id=${t}`;const o=document.createElement("h3");o.innerText=n;const i=document.createElement("img");return i.className="auction-item-image",a?.length>0&&a[0]?.url?(i.src=a[0].url,i.alt=a[0].alt||"Auction image"):i.alt="No image available",r.appendChild(i),r.appendChild(o),r}async function v(e){if(!e)throw new Error("This call needs a username");const t=await fetch(`${f}/${e}`,{headers:p()}),n=await t.json();if(!t.ok)throw new Error(n.errors[0].message);return n}function w(e){const t=document.querySelector("#profile-header"),n=document.querySelector("#profile-details");t&&(t.innerHTML=""),n&&(n.innerHTML="");const{name:a,bio:r,avatar:o,banner:i,credits:c}=e;if(t){if(i?.url){const l=document.createElement("div"),s=document.createElement("img");s.src=i.url,l.className="profile-banner",l.appendChild(s),t.appendChild(l)}if(o?.url){const l=document.createElement("div"),s=document.createElement("img");s.src=o.url,l.className="profile-avatar",l.appendChild(s),t.appendChild(l)}}if(n){if(a){const d=document.createElement("h3");d.textContent=a,n.appendChild(d)}const l=document.createElement("p");l.className="bio",l.textContent=r||"No bio available.",n.appendChild(l);const s=document.createElement("p");s.className="profile-credits",s.textContent=`Current Credits: ${c||0}`,n.appendChild(s)}}async function C({avatar:e,banner:t,bio:n}){const a=p(),r={};if(n&&(r.bio=n),e&&(r.avatar={url:e.url}),t&&(r.banner={url:t.url}),Object.keys(r).length===0)throw new Error("At least one property (bio, avatar, banner) must be provided for the update.");try{const o=u(),i=await fetch(`${f}/${o}`,{method:"PUT",headers:a,body:JSON.stringify(r)});if(!i.ok){const c=await i.json();throw console.error("Failed to update profile:",c),new Error(`Failed to update profile: ${c.message}`)}return await i.json()}catch(o){throw console.error("Error updating profile:",o.message),o}}async function I(e){e.preventDefault();const t=document.getElementById("avatar-url").value,n=document.getElementById("banner-url").value,a=document.getElementById("bio").value,r={avatar:t?{url:t}:void 0,banner:n?{url:n}:void 0,bio:a||void 0};try{await C(r),m("#message","success","Profile updated succesdfully."),E()}catch(o){m("#message","error",o.message)}}h();async function P(){const e=u();if(!e){console.error("Username not found");return}try{const t=await v(e);w(t.data);const n=document.getElementById("my-listings"),a=await g(e);y(n,a)}catch(t){console.error(t.message)}}P();function B(){document.getElementById("profile-edit-modal").style.display="block"}function E(){document.getElementById("profile-edit-modal").style.display="none"}const L=document.getElementById("edit-profile-button");L?.addEventListener("click",function(e){e.preventDefault(),B()});const N=document.getElementById("cancel-edit");N?.addEventListener("click",function(){E()});document.getElementById("profile-edit-form")?.addEventListener("submit",I);
