import{l as y,i as w}from"./main-DxMEcUNX.js";import{a as S}from"./readAuction-DM6NZyQF.js";import{a as T,h as A,d as r}from"./headers-es2B9U5o.js";async function D(t){if((await fetch(`${T}/${t}`,{method:"DELETE",headers:A()})).ok===!1)throw new Error("Delete failed")}async function B(t){if(t.preventDefault(),confirm("Are you sure you want to delete this listing?")){const n=t.target,{id:a}=n.dataset;try{await D(a),n.removeEventListener("click",B);const e=n.closest("a.auction");e&&e.remove(),r("#message","success","Listing deleted successfully."),setTimeout(()=>{window.location.href="/profile/"},2e3)}catch(e){console.error("Error deleting: ",e.message),r("#message","error",e.message)}}}async function P(t,n){const a=A(),e=JSON.stringify({amount:n});try{const i=await fetch(`${T}/${t}/bids`,{method:"POST",headers:a,body:e}),o=await i.json();if(!i.ok)throw new Error(o.errors?o.errors[0].message:"An error occurred while placing the bid.");return o}catch(i){throw console.error("Failed to place bid:",i.message),i}}async function k(t,n,a){if(t.preventDefault(),isNaN(a)||a<=0){alert("Please enter a valid bid amount.");return}try{const e=await P(n,a);r("#message","success","Bid placed successfully.")}catch(e){r("#message","error",e.message)}}function I(t,n){const a=document.createElement("div");a.classList.add("bid-input-container");const e=document.createElement("input");e.type="number",e.id="bid-amount",e.placeholder="Enter your bid amount",a.appendChild(e);const i=document.createElement("button");i.innerText="Submit",i.dataset.id=n,a.appendChild(i);const o=document.createElement("button");o.innerText="Cancel",o.addEventListener("click",()=>{a.remove()}),a.appendChild(o),t.parentNode.appendChild(a),i.addEventListener("click",s=>{s.preventDefault();const l=parseFloat(e.value);if(isNaN(l)||l<=0){alert("Please enter a valid bid amount.");return}k(s,n,l),a.remove()})}function M(t){const n=y(),{seller:a,id:e}=t,i=a.name,o=document.createElement("div");if(o.classList.add("auction-buttons","flex","gap-4","mt-4"),i===n){const s=document.createElement("button");s.classList.add("delete-button"),s.innerText="Delete",s.dataset.id=e,s.addEventListener("click",B),o.appendChild(s)}else if(w()){const s=document.createElement("button");s.innerText="Place Bid",s.classList.add("place-bid-button"),s.dataset.id=e,s.addEventListener("click",()=>{I(s,e)}),o.appendChild(s)}return o}function H(t,n){t.innerHTML="";const{title:a,description:e,media:i,endsAt:o,seller:s}=n,l=s.name,$=y(),p=document.createElement("div");p.classList.add("auction-left-col");const c=document.createElement("div");c.classList.add("auction-right-col");const f=document.createElement("h1");f.classList.add("auction-title"),f.innerText=a,c.appendChild(f);const E=document.createElement("p");E.classList.add("auction-description"),E.innerText=e||"No description provided.",c.appendChild(E);const u=M(n);u&&(u.classList.add("auction-admin-buttons"),c.appendChild(u));const h=document.createElement("p");h.classList.add("auction-ends-at");const N=new Date,g=new Date(o);if(N>g?(h.innerText=`Ended At: ${g.toLocaleString()}`,l!==$&&u&&u.remove()):h.innerText=`Ends At: ${g.toLocaleString()}`,c.appendChild(h),t.appendChild(c),i&&i.length>0){const b=document.createElement("div");b.classList.add("active-image-container");const d=document.createElement("img");if(d.classList.add("auction-active-image"),d.src=i[0].url,d.alt=i[0].alt||"Main Auction Image",b.appendChild(d),p.appendChild(b),i.length>1){const L=document.createElement("div");L.classList.add("thumbnails-container"),i.slice(0,4).forEach(({url:v,alt:C},x)=>{const m=document.createElement("img");m.src=v,m.alt=C||`Auction Thumbnail ${x+1}`,m.classList.add("auction-thumbnail"),m.addEventListener("click",()=>{d.src=v,d.alt=C||"Main Auction Image"}),L.appendChild(m)}),p.appendChild(L)}}t.appendChild(p)}function O(t,n){if(t.innerHTML="",!n||n.length===0){t.innerHTML="<p>No bids yet.</p>";return}n.reverse();const a=n[0],e=document.createElement("p");e.innerText=`Highest Bid: $${a.amount}`,t.appendChild(e);const i=document.createElement("button");i.classList.add("button-secondary"),i.innerText="Show All Bids",t.appendChild(i),i.addEventListener("click",()=>{t.innerHTML="",n.forEach(o=>{const s=document.createElement("p");s.innerText=`Bidder: ${o.bidder.name} | Amount: $${o.amount}`,t.appendChild(s)})})}function q(t){return new URLSearchParams(window.location.search).get(t)}function F(t){document.title=`${t} | ${document.title}`}async function U(){const t=q("id");t||(window.location.href="/");const n=document.querySelector("#auctionDetails"),a=document.querySelector("#auctionBids");w()||(a.style.display="none");try{const e=await S(t);e.data?(F(e.data.title),H(n,e.data),O(a,e.data.bids)):r(n,"error","Auction not found.")}catch(e){console.error(e),r(n,"error",e.message)}}U();
